; ============================================
; 花蓮計程車 Asterisk PJSIP 設定
; ============================================
;
; HT813 FXO 轉接來電時，From header 會帶來電者號碼（非 ht813），
; 所以必須用 identify_by=auth_username 讓 Asterisk 透過認證用戶名辨識 endpoint。
;
; 部署方式：
;   sudo cp pjsip_taxi.conf /etc/asterisk/pjsip_taxi.conf
;   sudo asterisk -rx 'module reload res_pjsip.so'
;   sudo asterisk -rx 'pjsip reload'
;
; 最後更新：2026-03-01
; ============================================

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
external_media_address=15.164.245.47
external_signaling_address=15.164.245.47
local_net=172.26.0.0/16

; --- HT813 FXO ---
[ht813]
type=endpoint
context=from-phone
disallow=all
allow=ulaw
allow=alaw
auth=ht813-auth
aors=ht813
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes
identify_by=username,auth_username,ip

[ht813-auth]
type=auth
auth_type=userpass
username=ht813
password=hualientaxi2026

[ht813]
type=aor
max_contacts=1
remove_existing=yes
qualify_frequency=30

; --- Softphone 測試 ---
[softphone]
type=endpoint
context=from-phone
disallow=all
allow=ulaw
allow=alaw
allow=opus
auth=softphone-auth
aors=softphone
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[softphone-auth]
type=auth
auth_type=userpass
username=softphone
password=hualientaxi2026

[softphone]
type=aor
max_contacts=1
remove_existing=yes
qualify_frequency=30
